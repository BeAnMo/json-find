/* 
    JSON-Find
Small utility for searching through JSON or a JSON-compatible object for values at
given keys.  
*/
'use strict';
/**** JSON document ***
    "this" assumes an Object or Array */

function _typeof(obj) { if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

var JSON_DATA = Object.create({}, {
  checkKey: {
    configurable: false,
    enumerable: false,

    /* object at given key or false */
    value: function value(key) {
      return reduceJSON(false, this, function (n, m) {
        return m;
      }, key);
    }
  },
  findValues: {
    configurable: false,
    enumerable: false,

    /* object at given key or false */
    value: function value() {
      for (var _len = arguments.length, keys = new Array(_len), _key = 0; _key < _len; _key++) {
        keys[_key] = arguments[_key];
      }

      return findValues.apply(void 0, [this].concat(keys));
    }
  },
  extractPaths: {
    configurable: false,
    enumerable: false,

    /* extract objects at given paths */
    value: function value(useNewKeys) {
      for (var _len2 = arguments.length, keys = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {
        keys[_key2 - 1] = arguments[_key2];
      }

      return extractPaths.apply(void 0, [this, useNewKeys].concat(keys));
    }
  }
});
/*** Constructor *** 
    JsonFind will return Atoms as is, Arrays & Objects are
    converted to JsonFind Object */

function JsonFind(doc) {
  var possibleJson = JSON.stringify(doc);

  if (possibleJson === undefined) {
    throw new Error('Object is invalid JSON');
  } else if (isAtom(doc) || doc === null) {
    return doc;
  } else {
    return Object.assign(Object.create(JSON_DATA), doc);
  }
}

var assignments = function () {
  Object.assign(JsonFind, {
    prototype: JSON_DATA
  });
}();

module.exports = JsonFind;
/*** JSON_DATA methods ***/

/* Object, ...String -> Object
    searches through an object for all given keys,
    return an object of search keys & their values  */

function findValues(toSearch) {
  for (var _len3 = arguments.length, searchFor = new Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {
    searchFor[_key3 - 1] = arguments[_key3];
  }

  var searchesLen = searchFor.length;
  var results = {};
  var searches = {};

  for (var i = 0; i < searchesLen; i++) {
    searches[searchFor[i]] = true;
  }
  /* Object, Object -> Void */


  function traverseObject(toSearchObj, searchForObj) {
    var allKeys = Object.keys(toSearchObj);
    var len = allKeys.length;

    for (var _i = 0; _i < len; _i++) {
      var key = allKeys[_i];
      var val = toSearchObj[key];

      if (searchForObj[key] && !results[key]) {
        results[key] = val;
      } else if (isObject(val)) {
        traverseObject(val, searchForObj);
      } else if (isArray(val)) {
        traverseArray(val, searchForObj);
      }
    }
  }
  /* Array, Object -> Void */


  function traverseArray(arr, searchForObj) {
    var len = arr.length;

    for (var _i2 = 0; _i2 < len; _i2++) {
      var item = arr[_i2];

      if (isArray(item)) {
        traverseArray(item, searchForObj);
      } else if (isObject(item)) {
        traverseObject(item, searchForObj);
      }
    }
  }

  traverseObject(toSearch, searches);
  return results;
}
/* applies function to value at given key */


function reduceJSON(accum, json, fn, searchFor) {
  if (isKey(json, searchFor)) {
    return fn(accum, json[searchFor]);
  } else if (isAtom(json)) {
    return accum;
  } else if (isArray(json)) {
    return json.reduce(function (acc, item) {
      return reduceJSON(acc, item, fn, searchFor);
    }, accum);
  } else {
    var keys = Object.keys(json);
    return keys.reduce(function (acc, key) {
      return reduceJSON(acc, json[key], fn, searchFor);
    }, accum);
  }
}
/* Object, Array-of-String, ...Array-of-String -> Object 
    extracts values from an object from multiples paths: 
    a Path is [...String] 
    assumes newKeys is false or [...String] */


function extractPaths(obj, newKeys) {
  var nkLen = newKeys.length;

  for (var _len4 = arguments.length, paths = new Array(_len4 > 2 ? _len4 - 2 : 0), _key4 = 2; _key4 < _len4; _key4++) {
    paths[_key4 - 2] = arguments[_key4];
  }

  var pLen = paths.length;
  var curried = curry(assignKeysAtPaths, obj, newKeys, paths);
  return nkLen > pLen ? curried(nkLen) : curried(pLen);
}
/*** Helpers ***/

/* JSON, [...String], [...[...String]], Number -> Object */


function assignKeysAtPaths(obj, newKeys, paths, loopLen) {
  var result = {};

  for (var i = 0; i < loopLen; i++) {
    // allows for unequal newKeys/paths lengths
    var iPath = paths[i] ? paths[i] : null;
    var iNewKey = newKeys[i] ? newKeys[i] : paths[i].slice(-1);
    var objAtPath = iPath === null ? null : recurPath(obj, iPath);
    var key = objAtPath ? Object.keys(objAtPath)[0] : null;
    var curried = curry(Object.assign, result); // prevent same keys from overriding

    if (newKeys) {
      if (objAtPath) {
        curried(_defineProperty({}, iNewKey, objAtPath[key]));
      } else {
        curried(_defineProperty({}, iNewKey, objAtPath));
      }
    } else if (key in result) {
      curried(_defineProperty({}, key + '+' + i, objAtPath[key]));
    } else {
      curried(objAtPath);
    }
  }

  return result;
}
/* Object, Array-of-String -> Object
    retrieves the value of an object at the given path
    returns { String-X: object }
    where String-X is the key from the last index of 
    the given array */


function recurPath(obj, arr) {
  var lastKey = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : '';

  if (arr.length === 0) {
    return _defineProperty({}, lastKey, obj);
  } else {
    return recurPath(obj[arr[0]], arr.slice(1), arr[0]);
  }
}
/* [[...X -> Y], ...X -> [...Y -> Z]] -> Z */


function curry(fn) {
  for (var _len5 = arguments.length, firstArgs = new Array(_len5 > 1 ? _len5 - 1 : 0), _key5 = 1; _key5 < _len5; _key5++) {
    firstArgs[_key5 - 1] = arguments[_key5];
  }

  return function () {
    for (var _len6 = arguments.length, secondArgs = new Array(_len6), _key6 = 0; _key6 < _len6; _key6++) {
      secondArgs[_key6] = arguments[_key6];
    }

    return fn.apply(null, firstArgs.concat(secondArgs));
  };
}

function isAtom(v) {
  return null === v || typeof v === 'boolean' || typeof v === 'number' || typeof v === 'string';
}

function isArray(v) {
  return Array.isArray(v);
}

function isObject(v) {
  return _typeof(v) === 'object' && !isArray(v) && v !== null;
}

function isNull(v) {
  return null === v ? 'null' : v;
}

function isCompound(v) {
  return isArray(v) || isObject(v);
}

function isKey(json, searchFor) {
  return json === null ? false : isCompound(json) && searchFor in json;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9qc29uLWZpbmQuanMiXSwibmFtZXMiOlsiSlNPTl9EQVRBIiwiT2JqZWN0IiwiY3JlYXRlIiwiY2hlY2tLZXkiLCJjb25maWd1cmFibGUiLCJlbnVtZXJhYmxlIiwidmFsdWUiLCJrZXkiLCJyZWR1Y2VKU09OIiwibiIsIm0iLCJmaW5kVmFsdWVzIiwia2V5cyIsImV4dHJhY3RQYXRocyIsInVzZU5ld0tleXMiLCJKc29uRmluZCIsImRvYyIsInBvc3NpYmxlSnNvbiIsIkpTT04iLCJzdHJpbmdpZnkiLCJ1bmRlZmluZWQiLCJFcnJvciIsImlzQXRvbSIsImFzc2lnbiIsImFzc2lnbm1lbnRzIiwicHJvdG90eXBlIiwibW9kdWxlIiwiZXhwb3J0cyIsInRvU2VhcmNoIiwic2VhcmNoRm9yIiwic2VhcmNoZXNMZW4iLCJsZW5ndGgiLCJyZXN1bHRzIiwic2VhcmNoZXMiLCJpIiwidHJhdmVyc2VPYmplY3QiLCJ0b1NlYXJjaE9iaiIsInNlYXJjaEZvck9iaiIsImFsbEtleXMiLCJsZW4iLCJ2YWwiLCJpc09iamVjdCIsImlzQXJyYXkiLCJ0cmF2ZXJzZUFycmF5IiwiYXJyIiwiaXRlbSIsImFjY3VtIiwianNvbiIsImZuIiwiaXNLZXkiLCJyZWR1Y2UiLCJhY2MiLCJvYmoiLCJuZXdLZXlzIiwibmtMZW4iLCJwYXRocyIsInBMZW4iLCJjdXJyaWVkIiwiY3VycnkiLCJhc3NpZ25LZXlzQXRQYXRocyIsImxvb3BMZW4iLCJyZXN1bHQiLCJpUGF0aCIsImlOZXdLZXkiLCJzbGljZSIsIm9iakF0UGF0aCIsInJlY3VyUGF0aCIsImxhc3RLZXkiLCJmaXJzdEFyZ3MiLCJzZWNvbmRBcmdzIiwiYXBwbHkiLCJjb25jYXQiLCJ2IiwiQXJyYXkiLCJpc051bGwiLCJpc0NvbXBvdW5kIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7QUFNQTtBQUVBOzs7Ozs7O0FBRUEsSUFBTUEsU0FBUyxHQUFHQyxNQUFNLENBQUNDLE1BQVAsQ0FDaEIsRUFEZ0IsRUFFaEI7QUFDRUMsRUFBQUEsUUFBUSxFQUFFO0FBQ1JDLElBQUFBLFlBQVksRUFBRSxLQUROO0FBRVJDLElBQUFBLFVBQVUsRUFBRSxLQUZKOztBQUdSO0FBQ0FDLElBQUFBLEtBQUssRUFBRSxlQUFTQyxHQUFULEVBQWM7QUFDbkIsYUFBT0MsVUFBVSxDQUFDLEtBQUQsRUFBUSxJQUFSLEVBQWMsVUFBQ0MsQ0FBRCxFQUFJQyxDQUFKO0FBQUEsZUFBVUEsQ0FBVjtBQUFBLE9BQWQsRUFBMkJILEdBQTNCLENBQWpCO0FBQ0Q7QUFOTyxHQURaO0FBU0VJLEVBQUFBLFVBQVUsRUFBRTtBQUNWUCxJQUFBQSxZQUFZLEVBQUUsS0FESjtBQUVWQyxJQUFBQSxVQUFVLEVBQUUsS0FGRjs7QUFHVjtBQUNBQyxJQUFBQSxLQUFLLEVBQUUsaUJBQWtCO0FBQUEsd0NBQU5NLElBQU07QUFBTkEsUUFBQUEsSUFBTTtBQUFBOztBQUN2QixhQUFPRCxVQUFVLE1BQVYsVUFBVyxJQUFYLFNBQW9CQyxJQUFwQixFQUFQO0FBQ0Q7QUFOUyxHQVRkO0FBaUJFQyxFQUFBQSxZQUFZLEVBQUU7QUFDWlQsSUFBQUEsWUFBWSxFQUFFLEtBREY7QUFFWkMsSUFBQUEsVUFBVSxFQUFFLEtBRkE7O0FBR1o7QUFDQUMsSUFBQUEsS0FBSyxFQUFFLGVBQVNRLFVBQVQsRUFBOEI7QUFBQSx5Q0FBTkYsSUFBTTtBQUFOQSxRQUFBQSxJQUFNO0FBQUE7O0FBQ25DLGFBQU9DLFlBQVksTUFBWixVQUFhLElBQWIsRUFBbUJDLFVBQW5CLFNBQWtDRixJQUFsQyxFQUFQO0FBQ0Q7QUFOVztBQWpCaEIsQ0FGZ0IsQ0FBbEI7QUE4QkE7Ozs7QUFHQSxTQUFTRyxRQUFULENBQWtCQyxHQUFsQixFQUF1QjtBQUNyQixNQUFNQyxZQUFZLEdBQUdDLElBQUksQ0FBQ0MsU0FBTCxDQUFlSCxHQUFmLENBQXJCOztBQUVBLE1BQUlDLFlBQVksS0FBS0csU0FBckIsRUFBZ0M7QUFDOUIsVUFBTSxJQUFJQyxLQUFKLENBQVUsd0JBQVYsQ0FBTjtBQUNELEdBRkQsTUFFTyxJQUFJQyxNQUFNLENBQUNOLEdBQUQsQ0FBTixJQUFlQSxHQUFHLEtBQUssSUFBM0IsRUFBaUM7QUFDdEMsV0FBT0EsR0FBUDtBQUNELEdBRk0sTUFFQTtBQUNMLFdBQU9mLE1BQU0sQ0FBQ3NCLE1BQVAsQ0FBY3RCLE1BQU0sQ0FBQ0MsTUFBUCxDQUFjRixTQUFkLENBQWQsRUFBd0NnQixHQUF4QyxDQUFQO0FBQ0Q7QUFDRjs7QUFFRCxJQUFJUSxXQUFXLEdBQUksWUFBTTtBQUN2QnZCLEVBQUFBLE1BQU0sQ0FBQ3NCLE1BQVAsQ0FBY1IsUUFBZCxFQUF3QjtBQUFFVSxJQUFBQSxTQUFTLEVBQUV6QjtBQUFiLEdBQXhCO0FBQ0QsQ0FGaUIsRUFBbEI7O0FBSUEwQixNQUFNLENBQUNDLE9BQVAsR0FBaUJaLFFBQWpCO0FBRUE7O0FBRUE7Ozs7QUFHQSxTQUFTSixVQUFULENBQW9CaUIsUUFBcEIsRUFBNEM7QUFBQSxxQ0FBWEMsU0FBVztBQUFYQSxJQUFBQSxTQUFXO0FBQUE7O0FBQzFDLE1BQU1DLFdBQVcsR0FBR0QsU0FBUyxDQUFDRSxNQUE5QjtBQUNBLE1BQUlDLE9BQU8sR0FBRyxFQUFkO0FBQ0EsTUFBSUMsUUFBUSxHQUFHLEVBQWY7O0FBRUEsT0FBSyxJQUFJQyxDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHSixXQUFwQixFQUFpQ0ksQ0FBQyxFQUFsQyxFQUFzQztBQUNwQ0QsSUFBQUEsUUFBUSxDQUFDSixTQUFTLENBQUNLLENBQUQsQ0FBVixDQUFSLEdBQXlCLElBQXpCO0FBQ0Q7QUFFRDs7O0FBQ0EsV0FBU0MsY0FBVCxDQUF3QkMsV0FBeEIsRUFBcUNDLFlBQXJDLEVBQW1EO0FBQ2pELFFBQU1DLE9BQU8sR0FBR3JDLE1BQU0sQ0FBQ1csSUFBUCxDQUFZd0IsV0FBWixDQUFoQjtBQUNBLFFBQU1HLEdBQUcsR0FBR0QsT0FBTyxDQUFDUCxNQUFwQjs7QUFFQSxTQUFLLElBQUlHLEVBQUMsR0FBRyxDQUFiLEVBQWdCQSxFQUFDLEdBQUdLLEdBQXBCLEVBQXlCTCxFQUFDLEVBQTFCLEVBQThCO0FBQzVCLFVBQU0zQixHQUFHLEdBQUcrQixPQUFPLENBQUNKLEVBQUQsQ0FBbkI7QUFDQSxVQUFNTSxHQUFHLEdBQUdKLFdBQVcsQ0FBQzdCLEdBQUQsQ0FBdkI7O0FBRUEsVUFBSThCLFlBQVksQ0FBQzlCLEdBQUQsQ0FBWixJQUFxQixDQUFDeUIsT0FBTyxDQUFDekIsR0FBRCxDQUFqQyxFQUF3QztBQUN0Q3lCLFFBQUFBLE9BQU8sQ0FBQ3pCLEdBQUQsQ0FBUCxHQUFlaUMsR0FBZjtBQUNELE9BRkQsTUFFTyxJQUFJQyxRQUFRLENBQUNELEdBQUQsQ0FBWixFQUFtQjtBQUN4QkwsUUFBQUEsY0FBYyxDQUFDSyxHQUFELEVBQU1ILFlBQU4sQ0FBZDtBQUNELE9BRk0sTUFFQSxJQUFJSyxPQUFPLENBQUNGLEdBQUQsQ0FBWCxFQUFrQjtBQUN2QkcsUUFBQUEsYUFBYSxDQUFDSCxHQUFELEVBQU1ILFlBQU4sQ0FBYjtBQUNEO0FBQ0Y7QUFDRjtBQUVEOzs7QUFDQSxXQUFTTSxhQUFULENBQXVCQyxHQUF2QixFQUE0QlAsWUFBNUIsRUFBMEM7QUFDeEMsUUFBTUUsR0FBRyxHQUFHSyxHQUFHLENBQUNiLE1BQWhCOztBQUVBLFNBQUssSUFBSUcsR0FBQyxHQUFHLENBQWIsRUFBZ0JBLEdBQUMsR0FBR0ssR0FBcEIsRUFBeUJMLEdBQUMsRUFBMUIsRUFBOEI7QUFDNUIsVUFBTVcsSUFBSSxHQUFHRCxHQUFHLENBQUNWLEdBQUQsQ0FBaEI7O0FBRUEsVUFBSVEsT0FBTyxDQUFDRyxJQUFELENBQVgsRUFBbUI7QUFDakJGLFFBQUFBLGFBQWEsQ0FBQ0UsSUFBRCxFQUFPUixZQUFQLENBQWI7QUFDRCxPQUZELE1BRU8sSUFBSUksUUFBUSxDQUFDSSxJQUFELENBQVosRUFBb0I7QUFDekJWLFFBQUFBLGNBQWMsQ0FBQ1UsSUFBRCxFQUFPUixZQUFQLENBQWQ7QUFDRDtBQUNGO0FBQ0Y7O0FBRURGLEVBQUFBLGNBQWMsQ0FBQ1AsUUFBRCxFQUFXSyxRQUFYLENBQWQ7QUFFQSxTQUFPRCxPQUFQO0FBQ0Q7QUFFRDs7O0FBQ0EsU0FBU3hCLFVBQVQsQ0FBb0JzQyxLQUFwQixFQUEyQkMsSUFBM0IsRUFBaUNDLEVBQWpDLEVBQXFDbkIsU0FBckMsRUFBZ0Q7QUFDOUMsTUFBSW9CLEtBQUssQ0FBQ0YsSUFBRCxFQUFPbEIsU0FBUCxDQUFULEVBQTRCO0FBQzFCLFdBQU9tQixFQUFFLENBQUNGLEtBQUQsRUFBUUMsSUFBSSxDQUFDbEIsU0FBRCxDQUFaLENBQVQ7QUFDRCxHQUZELE1BRU8sSUFBSVAsTUFBTSxDQUFDeUIsSUFBRCxDQUFWLEVBQWtCO0FBQ3ZCLFdBQU9ELEtBQVA7QUFDRCxHQUZNLE1BRUEsSUFBSUosT0FBTyxDQUFDSyxJQUFELENBQVgsRUFBbUI7QUFDeEIsV0FBT0EsSUFBSSxDQUFDRyxNQUFMLENBQVksVUFBQ0MsR0FBRCxFQUFNTixJQUFOLEVBQWU7QUFDaEMsYUFBT3JDLFVBQVUsQ0FBQzJDLEdBQUQsRUFBTU4sSUFBTixFQUFZRyxFQUFaLEVBQWdCbkIsU0FBaEIsQ0FBakI7QUFDRCxLQUZNLEVBRUppQixLQUZJLENBQVA7QUFHRCxHQUpNLE1BSUE7QUFDTCxRQUFNbEMsSUFBSSxHQUFHWCxNQUFNLENBQUNXLElBQVAsQ0FBWW1DLElBQVosQ0FBYjtBQUVBLFdBQU9uQyxJQUFJLENBQUNzQyxNQUFMLENBQVksVUFBQ0MsR0FBRCxFQUFNNUMsR0FBTixFQUFjO0FBQy9CLGFBQU9DLFVBQVUsQ0FBQzJDLEdBQUQsRUFBTUosSUFBSSxDQUFDeEMsR0FBRCxDQUFWLEVBQWlCeUMsRUFBakIsRUFBcUJuQixTQUFyQixDQUFqQjtBQUNELEtBRk0sRUFFSmlCLEtBRkksQ0FBUDtBQUdEO0FBQ0Y7QUFFRDs7Ozs7O0FBSUEsU0FBU2pDLFlBQVQsQ0FBc0J1QyxHQUF0QixFQUEyQkMsT0FBM0IsRUFBOEM7QUFDNUMsTUFBTUMsS0FBSyxHQUFHRCxPQUFPLENBQUN0QixNQUF0Qjs7QUFENEMscUNBQVB3QixLQUFPO0FBQVBBLElBQUFBLEtBQU87QUFBQTs7QUFFNUMsTUFBTUMsSUFBSSxHQUFHRCxLQUFLLENBQUN4QixNQUFuQjtBQUVBLE1BQU0wQixPQUFPLEdBQUdDLEtBQUssQ0FBQ0MsaUJBQUQsRUFBb0JQLEdBQXBCLEVBQXlCQyxPQUF6QixFQUFrQ0UsS0FBbEMsQ0FBckI7QUFFQSxTQUFPRCxLQUFLLEdBQUdFLElBQVIsR0FBZUMsT0FBTyxDQUFDSCxLQUFELENBQXRCLEdBQWdDRyxPQUFPLENBQUNELElBQUQsQ0FBOUM7QUFDRDtBQUVEOztBQUVBOzs7QUFDQSxTQUFTRyxpQkFBVCxDQUEyQlAsR0FBM0IsRUFBZ0NDLE9BQWhDLEVBQXlDRSxLQUF6QyxFQUFnREssT0FBaEQsRUFBeUQ7QUFDdkQsTUFBSUMsTUFBTSxHQUFHLEVBQWI7O0FBRUEsT0FBSyxJQUFJM0IsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBRzBCLE9BQXBCLEVBQTZCMUIsQ0FBQyxFQUE5QixFQUFrQztBQUNoQztBQUNBLFFBQU00QixLQUFLLEdBQUdQLEtBQUssQ0FBQ3JCLENBQUQsQ0FBTCxHQUFXcUIsS0FBSyxDQUFDckIsQ0FBRCxDQUFoQixHQUFzQixJQUFwQztBQUNBLFFBQU02QixPQUFPLEdBQUdWLE9BQU8sQ0FBQ25CLENBQUQsQ0FBUCxHQUFhbUIsT0FBTyxDQUFDbkIsQ0FBRCxDQUFwQixHQUEwQnFCLEtBQUssQ0FBQ3JCLENBQUQsQ0FBTCxDQUFTOEIsS0FBVCxDQUFlLENBQUMsQ0FBaEIsQ0FBMUM7QUFFQSxRQUFNQyxTQUFTLEdBQUdILEtBQUssS0FBSyxJQUFWLEdBQWlCLElBQWpCLEdBQXdCSSxTQUFTLENBQUNkLEdBQUQsRUFBTVUsS0FBTixDQUFuRDtBQUNBLFFBQU12RCxHQUFHLEdBQUcwRCxTQUFTLEdBQUdoRSxNQUFNLENBQUNXLElBQVAsQ0FBWXFELFNBQVosRUFBdUIsQ0FBdkIsQ0FBSCxHQUErQixJQUFwRDtBQUVBLFFBQU1SLE9BQU8sR0FBR0MsS0FBSyxDQUFDekQsTUFBTSxDQUFDc0IsTUFBUixFQUFnQnNDLE1BQWhCLENBQXJCLENBUmdDLENBVWhDOztBQUNBLFFBQUlSLE9BQUosRUFBYTtBQUNYLFVBQUlZLFNBQUosRUFBZTtBQUNiUixRQUFBQSxPQUFPLHFCQUFJTSxPQUFKLEVBQWNFLFNBQVMsQ0FBQzFELEdBQUQsQ0FBdkIsRUFBUDtBQUNELE9BRkQsTUFFTztBQUNMa0QsUUFBQUEsT0FBTyxxQkFBSU0sT0FBSixFQUFjRSxTQUFkLEVBQVA7QUFDRDtBQUNGLEtBTkQsTUFNTyxJQUFJMUQsR0FBRyxJQUFJc0QsTUFBWCxFQUFtQjtBQUN4QkosTUFBQUEsT0FBTyxxQkFBSWxELEdBQUcsR0FBRyxHQUFOLEdBQVkyQixDQUFoQixFQUFvQitCLFNBQVMsQ0FBQzFELEdBQUQsQ0FBN0IsRUFBUDtBQUNELEtBRk0sTUFFQTtBQUNMa0QsTUFBQUEsT0FBTyxDQUFDUSxTQUFELENBQVA7QUFDRDtBQUNGOztBQUVELFNBQU9KLE1BQVA7QUFDRDtBQUVEOzs7Ozs7O0FBS0EsU0FBU0ssU0FBVCxDQUFtQmQsR0FBbkIsRUFBd0JSLEdBQXhCLEVBQTJDO0FBQUEsTUFBZHVCLE9BQWMsdUVBQUosRUFBSTs7QUFDekMsTUFBSXZCLEdBQUcsQ0FBQ2IsTUFBSixLQUFlLENBQW5CLEVBQXNCO0FBQ3BCLCtCQUFVb0MsT0FBVixFQUFvQmYsR0FBcEI7QUFDRCxHQUZELE1BRU87QUFDTCxXQUFPYyxTQUFTLENBQUNkLEdBQUcsQ0FBQ1IsR0FBRyxDQUFDLENBQUQsQ0FBSixDQUFKLEVBQWNBLEdBQUcsQ0FBQ29CLEtBQUosQ0FBVSxDQUFWLENBQWQsRUFBNEJwQixHQUFHLENBQUMsQ0FBRCxDQUEvQixDQUFoQjtBQUNEO0FBQ0Y7QUFFRDs7O0FBQ0EsU0FBU2MsS0FBVCxDQUFlVixFQUFmLEVBQWlDO0FBQUEscUNBQVhvQixTQUFXO0FBQVhBLElBQUFBLFNBQVc7QUFBQTs7QUFDL0IsU0FBTyxZQUF3QjtBQUFBLHVDQUFaQyxVQUFZO0FBQVpBLE1BQUFBLFVBQVk7QUFBQTs7QUFDN0IsV0FBT3JCLEVBQUUsQ0FBQ3NCLEtBQUgsQ0FBUyxJQUFULEVBQWVGLFNBQVMsQ0FBQ0csTUFBVixDQUFpQkYsVUFBakIsQ0FBZixDQUFQO0FBQ0QsR0FGRDtBQUdEOztBQUVELFNBQVMvQyxNQUFULENBQWdCa0QsQ0FBaEIsRUFBbUI7QUFDakIsU0FDRSxTQUFTQSxDQUFULElBQ0EsT0FBT0EsQ0FBUCxLQUFhLFNBRGIsSUFFQSxPQUFPQSxDQUFQLEtBQWEsUUFGYixJQUdBLE9BQU9BLENBQVAsS0FBYSxRQUpmO0FBTUQ7O0FBRUQsU0FBUzlCLE9BQVQsQ0FBaUI4QixDQUFqQixFQUFvQjtBQUNsQixTQUFPQyxLQUFLLENBQUMvQixPQUFOLENBQWM4QixDQUFkLENBQVA7QUFDRDs7QUFFRCxTQUFTL0IsUUFBVCxDQUFrQitCLENBQWxCLEVBQXFCO0FBQ25CLFNBQU8sUUFBT0EsQ0FBUCxNQUFhLFFBQWIsSUFBeUIsQ0FBQzlCLE9BQU8sQ0FBQzhCLENBQUQsQ0FBakMsSUFBd0NBLENBQUMsS0FBSyxJQUFyRDtBQUNEOztBQUVELFNBQVNFLE1BQVQsQ0FBZ0JGLENBQWhCLEVBQW1CO0FBQ2pCLFNBQU8sU0FBU0EsQ0FBVCxHQUFhLE1BQWIsR0FBc0JBLENBQTdCO0FBQ0Q7O0FBRUQsU0FBU0csVUFBVCxDQUFvQkgsQ0FBcEIsRUFBdUI7QUFDckIsU0FBTzlCLE9BQU8sQ0FBQzhCLENBQUQsQ0FBUCxJQUFjL0IsUUFBUSxDQUFDK0IsQ0FBRCxDQUE3QjtBQUNEOztBQUVELFNBQVN2QixLQUFULENBQWVGLElBQWYsRUFBcUJsQixTQUFyQixFQUFnQztBQUM5QixTQUFPa0IsSUFBSSxLQUFLLElBQVQsR0FBZ0IsS0FBaEIsR0FBd0I0QixVQUFVLENBQUM1QixJQUFELENBQVYsSUFBb0JsQixTQUFTLElBQUlrQixJQUFoRTtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiLyogXG4gICAgSlNPTi1GaW5kXG5TbWFsbCB1dGlsaXR5IGZvciBzZWFyY2hpbmcgdGhyb3VnaCBKU09OIG9yIGEgSlNPTi1jb21wYXRpYmxlIG9iamVjdCBmb3IgdmFsdWVzIGF0XG5naXZlbiBrZXlzLiAgXG4qL1xuXG4ndXNlIHN0cmljdCc7XG5cbi8qKioqIEpTT04gZG9jdW1lbnQgKioqXG4gICAgXCJ0aGlzXCIgYXNzdW1lcyBhbiBPYmplY3Qgb3IgQXJyYXkgKi9cbmNvbnN0IEpTT05fREFUQSA9IE9iamVjdC5jcmVhdGUoXG4gIHt9LFxuICB7XG4gICAgY2hlY2tLZXk6IHtcbiAgICAgIGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4gICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgIC8qIG9iamVjdCBhdCBnaXZlbiBrZXkgb3IgZmFsc2UgKi9cbiAgICAgIHZhbHVlOiBmdW5jdGlvbihrZXkpIHtcbiAgICAgICAgcmV0dXJuIHJlZHVjZUpTT04oZmFsc2UsIHRoaXMsIChuLCBtKSA9PiBtLCBrZXkpO1xuICAgICAgfVxuICAgIH0sXG4gICAgZmluZFZhbHVlczoge1xuICAgICAgY29uZmlndXJhYmxlOiBmYWxzZSxcbiAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgLyogb2JqZWN0IGF0IGdpdmVuIGtleSBvciBmYWxzZSAqL1xuICAgICAgdmFsdWU6IGZ1bmN0aW9uKC4uLmtleXMpIHtcbiAgICAgICAgcmV0dXJuIGZpbmRWYWx1ZXModGhpcywgLi4ua2V5cyk7XG4gICAgICB9XG4gICAgfSxcbiAgICBleHRyYWN0UGF0aHM6IHtcbiAgICAgIGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4gICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgIC8qIGV4dHJhY3Qgb2JqZWN0cyBhdCBnaXZlbiBwYXRocyAqL1xuICAgICAgdmFsdWU6IGZ1bmN0aW9uKHVzZU5ld0tleXMsIC4uLmtleXMpIHtcbiAgICAgICAgcmV0dXJuIGV4dHJhY3RQYXRocyh0aGlzLCB1c2VOZXdLZXlzLCAuLi5rZXlzKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbik7XG5cbi8qKiogQ29uc3RydWN0b3IgKioqIFxuICAgIEpzb25GaW5kIHdpbGwgcmV0dXJuIEF0b21zIGFzIGlzLCBBcnJheXMgJiBPYmplY3RzIGFyZVxuICAgIGNvbnZlcnRlZCB0byBKc29uRmluZCBPYmplY3QgKi9cbmZ1bmN0aW9uIEpzb25GaW5kKGRvYykge1xuICBjb25zdCBwb3NzaWJsZUpzb24gPSBKU09OLnN0cmluZ2lmeShkb2MpO1xuXG4gIGlmIChwb3NzaWJsZUpzb24gPT09IHVuZGVmaW5lZCkge1xuICAgIHRocm93IG5ldyBFcnJvcignT2JqZWN0IGlzIGludmFsaWQgSlNPTicpO1xuICB9IGVsc2UgaWYgKGlzQXRvbShkb2MpIHx8IGRvYyA9PT0gbnVsbCkge1xuICAgIHJldHVybiBkb2M7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oT2JqZWN0LmNyZWF0ZShKU09OX0RBVEEpLCBkb2MpO1xuICB9XG59XG5cbmxldCBhc3NpZ25tZW50cyA9ICgoKSA9PiB7XG4gIE9iamVjdC5hc3NpZ24oSnNvbkZpbmQsIHsgcHJvdG90eXBlOiBKU09OX0RBVEEgfSk7XG59KSgpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IEpzb25GaW5kO1xuXG4vKioqIEpTT05fREFUQSBtZXRob2RzICoqKi9cblxuLyogT2JqZWN0LCAuLi5TdHJpbmcgLT4gT2JqZWN0XG4gICAgc2VhcmNoZXMgdGhyb3VnaCBhbiBvYmplY3QgZm9yIGFsbCBnaXZlbiBrZXlzLFxuICAgIHJldHVybiBhbiBvYmplY3Qgb2Ygc2VhcmNoIGtleXMgJiB0aGVpciB2YWx1ZXMgICovXG5mdW5jdGlvbiBmaW5kVmFsdWVzKHRvU2VhcmNoLCAuLi5zZWFyY2hGb3IpIHtcbiAgY29uc3Qgc2VhcmNoZXNMZW4gPSBzZWFyY2hGb3IubGVuZ3RoO1xuICBsZXQgcmVzdWx0cyA9IHt9O1xuICBsZXQgc2VhcmNoZXMgPSB7fTtcblxuICBmb3IgKGxldCBpID0gMDsgaSA8IHNlYXJjaGVzTGVuOyBpKyspIHtcbiAgICBzZWFyY2hlc1tzZWFyY2hGb3JbaV1dID0gdHJ1ZTtcbiAgfVxuXG4gIC8qIE9iamVjdCwgT2JqZWN0IC0+IFZvaWQgKi9cbiAgZnVuY3Rpb24gdHJhdmVyc2VPYmplY3QodG9TZWFyY2hPYmosIHNlYXJjaEZvck9iaikge1xuICAgIGNvbnN0IGFsbEtleXMgPSBPYmplY3Qua2V5cyh0b1NlYXJjaE9iaik7XG4gICAgY29uc3QgbGVuID0gYWxsS2V5cy5sZW5ndGg7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICBjb25zdCBrZXkgPSBhbGxLZXlzW2ldO1xuICAgICAgY29uc3QgdmFsID0gdG9TZWFyY2hPYmpba2V5XTtcblxuICAgICAgaWYgKHNlYXJjaEZvck9ialtrZXldICYmICFyZXN1bHRzW2tleV0pIHtcbiAgICAgICAgcmVzdWx0c1trZXldID0gdmFsO1xuICAgICAgfSBlbHNlIGlmIChpc09iamVjdCh2YWwpKSB7XG4gICAgICAgIHRyYXZlcnNlT2JqZWN0KHZhbCwgc2VhcmNoRm9yT2JqKTtcbiAgICAgIH0gZWxzZSBpZiAoaXNBcnJheSh2YWwpKSB7XG4gICAgICAgIHRyYXZlcnNlQXJyYXkodmFsLCBzZWFyY2hGb3JPYmopO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qIEFycmF5LCBPYmplY3QgLT4gVm9pZCAqL1xuICBmdW5jdGlvbiB0cmF2ZXJzZUFycmF5KGFyciwgc2VhcmNoRm9yT2JqKSB7XG4gICAgY29uc3QgbGVuID0gYXJyLmxlbmd0aDtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgIGNvbnN0IGl0ZW0gPSBhcnJbaV07XG5cbiAgICAgIGlmIChpc0FycmF5KGl0ZW0pKSB7XG4gICAgICAgIHRyYXZlcnNlQXJyYXkoaXRlbSwgc2VhcmNoRm9yT2JqKTtcbiAgICAgIH0gZWxzZSBpZiAoaXNPYmplY3QoaXRlbSkpIHtcbiAgICAgICAgdHJhdmVyc2VPYmplY3QoaXRlbSwgc2VhcmNoRm9yT2JqKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICB0cmF2ZXJzZU9iamVjdCh0b1NlYXJjaCwgc2VhcmNoZXMpO1xuXG4gIHJldHVybiByZXN1bHRzO1xufVxuXG4vKiBhcHBsaWVzIGZ1bmN0aW9uIHRvIHZhbHVlIGF0IGdpdmVuIGtleSAqL1xuZnVuY3Rpb24gcmVkdWNlSlNPTihhY2N1bSwganNvbiwgZm4sIHNlYXJjaEZvcikge1xuICBpZiAoaXNLZXkoanNvbiwgc2VhcmNoRm9yKSkge1xuICAgIHJldHVybiBmbihhY2N1bSwganNvbltzZWFyY2hGb3JdKTtcbiAgfSBlbHNlIGlmIChpc0F0b20oanNvbikpIHtcbiAgICByZXR1cm4gYWNjdW07XG4gIH0gZWxzZSBpZiAoaXNBcnJheShqc29uKSkge1xuICAgIHJldHVybiBqc29uLnJlZHVjZSgoYWNjLCBpdGVtKSA9PiB7XG4gICAgICByZXR1cm4gcmVkdWNlSlNPTihhY2MsIGl0ZW0sIGZuLCBzZWFyY2hGb3IpO1xuICAgIH0sIGFjY3VtKTtcbiAgfSBlbHNlIHtcbiAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoanNvbik7XG5cbiAgICByZXR1cm4ga2V5cy5yZWR1Y2UoKGFjYywga2V5KSA9PiB7XG4gICAgICByZXR1cm4gcmVkdWNlSlNPTihhY2MsIGpzb25ba2V5XSwgZm4sIHNlYXJjaEZvcik7XG4gICAgfSwgYWNjdW0pO1xuICB9XG59XG5cbi8qIE9iamVjdCwgQXJyYXktb2YtU3RyaW5nLCAuLi5BcnJheS1vZi1TdHJpbmcgLT4gT2JqZWN0IFxuICAgIGV4dHJhY3RzIHZhbHVlcyBmcm9tIGFuIG9iamVjdCBmcm9tIG11bHRpcGxlcyBwYXRoczogXG4gICAgYSBQYXRoIGlzIFsuLi5TdHJpbmddIFxuICAgIGFzc3VtZXMgbmV3S2V5cyBpcyBmYWxzZSBvciBbLi4uU3RyaW5nXSAqL1xuZnVuY3Rpb24gZXh0cmFjdFBhdGhzKG9iaiwgbmV3S2V5cywgLi4ucGF0aHMpIHtcbiAgY29uc3QgbmtMZW4gPSBuZXdLZXlzLmxlbmd0aDtcbiAgY29uc3QgcExlbiA9IHBhdGhzLmxlbmd0aDtcblxuICBjb25zdCBjdXJyaWVkID0gY3VycnkoYXNzaWduS2V5c0F0UGF0aHMsIG9iaiwgbmV3S2V5cywgcGF0aHMpO1xuXG4gIHJldHVybiBua0xlbiA+IHBMZW4gPyBjdXJyaWVkKG5rTGVuKSA6IGN1cnJpZWQocExlbik7XG59XG5cbi8qKiogSGVscGVycyAqKiovXG5cbi8qIEpTT04sIFsuLi5TdHJpbmddLCBbLi4uWy4uLlN0cmluZ11dLCBOdW1iZXIgLT4gT2JqZWN0ICovXG5mdW5jdGlvbiBhc3NpZ25LZXlzQXRQYXRocyhvYmosIG5ld0tleXMsIHBhdGhzLCBsb29wTGVuKSB7XG4gIGxldCByZXN1bHQgPSB7fTtcblxuICBmb3IgKGxldCBpID0gMDsgaSA8IGxvb3BMZW47IGkrKykge1xuICAgIC8vIGFsbG93cyBmb3IgdW5lcXVhbCBuZXdLZXlzL3BhdGhzIGxlbmd0aHNcbiAgICBjb25zdCBpUGF0aCA9IHBhdGhzW2ldID8gcGF0aHNbaV0gOiBudWxsO1xuICAgIGNvbnN0IGlOZXdLZXkgPSBuZXdLZXlzW2ldID8gbmV3S2V5c1tpXSA6IHBhdGhzW2ldLnNsaWNlKC0xKTtcblxuICAgIGNvbnN0IG9iakF0UGF0aCA9IGlQYXRoID09PSBudWxsID8gbnVsbCA6IHJlY3VyUGF0aChvYmosIGlQYXRoKTtcbiAgICBjb25zdCBrZXkgPSBvYmpBdFBhdGggPyBPYmplY3Qua2V5cyhvYmpBdFBhdGgpWzBdIDogbnVsbDtcblxuICAgIGNvbnN0IGN1cnJpZWQgPSBjdXJyeShPYmplY3QuYXNzaWduLCByZXN1bHQpO1xuXG4gICAgLy8gcHJldmVudCBzYW1lIGtleXMgZnJvbSBvdmVycmlkaW5nXG4gICAgaWYgKG5ld0tleXMpIHtcbiAgICAgIGlmIChvYmpBdFBhdGgpIHtcbiAgICAgICAgY3VycmllZCh7IFtpTmV3S2V5XTogb2JqQXRQYXRoW2tleV0gfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjdXJyaWVkKHsgW2lOZXdLZXldOiBvYmpBdFBhdGggfSk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChrZXkgaW4gcmVzdWx0KSB7XG4gICAgICBjdXJyaWVkKHsgW2tleSArICcrJyArIGldOiBvYmpBdFBhdGhba2V5XSB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgY3VycmllZChvYmpBdFBhdGgpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbi8qIE9iamVjdCwgQXJyYXktb2YtU3RyaW5nIC0+IE9iamVjdFxuICAgIHJldHJpZXZlcyB0aGUgdmFsdWUgb2YgYW4gb2JqZWN0IGF0IHRoZSBnaXZlbiBwYXRoXG4gICAgcmV0dXJucyB7IFN0cmluZy1YOiBvYmplY3QgfVxuICAgIHdoZXJlIFN0cmluZy1YIGlzIHRoZSBrZXkgZnJvbSB0aGUgbGFzdCBpbmRleCBvZiBcbiAgICB0aGUgZ2l2ZW4gYXJyYXkgKi9cbmZ1bmN0aW9uIHJlY3VyUGF0aChvYmosIGFyciwgbGFzdEtleSA9ICcnKSB7XG4gIGlmIChhcnIubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuIHsgW2xhc3RLZXldOiBvYmogfTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gcmVjdXJQYXRoKG9ialthcnJbMF1dLCBhcnIuc2xpY2UoMSksIGFyclswXSk7XG4gIH1cbn1cblxuLyogW1suLi5YIC0+IFldLCAuLi5YIC0+IFsuLi5ZIC0+IFpdXSAtPiBaICovXG5mdW5jdGlvbiBjdXJyeShmbiwgLi4uZmlyc3RBcmdzKSB7XG4gIHJldHVybiBmdW5jdGlvbiguLi5zZWNvbmRBcmdzKSB7XG4gICAgcmV0dXJuIGZuLmFwcGx5KG51bGwsIGZpcnN0QXJncy5jb25jYXQoc2Vjb25kQXJncykpO1xuICB9O1xufVxuXG5mdW5jdGlvbiBpc0F0b20odikge1xuICByZXR1cm4gKFxuICAgIG51bGwgPT09IHYgfHxcbiAgICB0eXBlb2YgdiA9PT0gJ2Jvb2xlYW4nIHx8XG4gICAgdHlwZW9mIHYgPT09ICdudW1iZXInIHx8XG4gICAgdHlwZW9mIHYgPT09ICdzdHJpbmcnXG4gICk7XG59XG5cbmZ1bmN0aW9uIGlzQXJyYXkodikge1xuICByZXR1cm4gQXJyYXkuaXNBcnJheSh2KTtcbn1cblxuZnVuY3Rpb24gaXNPYmplY3Qodikge1xuICByZXR1cm4gdHlwZW9mIHYgPT09ICdvYmplY3QnICYmICFpc0FycmF5KHYpICYmIHYgIT09IG51bGw7XG59XG5cbmZ1bmN0aW9uIGlzTnVsbCh2KSB7XG4gIHJldHVybiBudWxsID09PSB2ID8gJ251bGwnIDogdjtcbn1cblxuZnVuY3Rpb24gaXNDb21wb3VuZCh2KSB7XG4gIHJldHVybiBpc0FycmF5KHYpIHx8IGlzT2JqZWN0KHYpO1xufVxuXG5mdW5jdGlvbiBpc0tleShqc29uLCBzZWFyY2hGb3IpIHtcbiAgcmV0dXJuIGpzb24gPT09IG51bGwgPyBmYWxzZSA6IGlzQ29tcG91bmQoanNvbikgJiYgc2VhcmNoRm9yIGluIGpzb247XG59XG4iXX0=