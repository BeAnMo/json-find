"use strict";function t(t,e){let o=t,n=0;for(;void 0!==e[n]&&(o=o[e[n]],void 0!==o);)n++;return o}function e(t,e,o){let n=t,i=0;for(;void 0!==e[i+1];){const t=e[i];n=void 0===n[t]?n[t]=isNaN(e[i+1])?{}:[]:n[t],i++}return n[e[i]]=o,n}function o(t){return Array.isArray(t)}function n(t){return o(t)||function(t){return"object"==typeof t&&!o(t)&&null!==t}(t)}function i(t,e="."){return t.split(e)}function r(t,e){this.delimiter=e,o(t)?this.path=t:this.path=t.split(this.delimiter)}function s(t,e){this.doc=t,this.delim=e,this.q=[],this.setQueue(new r([],this.delim),Object.keys(this.doc))}function u(t,e={}){if(!n(t))throw new Error("Instantiating JsonFind requires an Object or an Array.");this.options={delimeter:e.delimeter||".",useConstructor:e.useConstructor||!1},this.doc=t}r.prototype.toString=function(){return this.path.join(this.delimiter)},r.prototype.toArray=function(){return this.path},r.prototype.clone=function(){return new r([...this.path],this.delimiter)},r.prototype.slice=function(t,e){return new r(this.path.slice(t,e),this.delimiter)},r.prototype.append=function(t){return this.path.push(t),this},s.prototype.setQueue=function(t,e){return e.forEach((e=>{const o=t.clone().append(e);this.q.push(o)})),this},s.prototype.next=function(){const e=this.q.shift(),o=t(this.doc,e.toArray());return n(o)?(this.setQueue(e,Object.keys(o)),this.next()):{path:e,value:o,key:e.slice(-1).toString()}},s.prototype.empty=function(){return 0===this.q.length},u.prototype.get=function(e,o={}){const r=o.useConstructor||this.options.useConstructor,s=i(e,this.options.delimeter),c=t(this.doc,s);return r&&n(c)?new u(c,this.options):c},u.prototype.set=function(t,o){const n=i(t,this.options.delimeter);return e(this.doc,n,o),this},u.prototype.dump=function(){return this.doc},u.prototype.each=function(t){const e=new s(this.doc,this.options.delimeter);for(;!e.empty();)t.call(this,e.next())},u.prototype.transform=function(t){const e=new s(this.doc,this.options.delimeter),o=new u(u.getBase(this.doc),this.options);for(;!e.empty();){const n=e.next();o.set(n.path.toArray(),t.call(this,n))}return o},u.prototype.prune=function(t){const e=new s(this.doc,this.options.delimeter),o=new u(u.getBase(this.doc),this.options);for(;!e.empty();){const n=e.next();t.call(this,n)&&o.set(n.path.toString(),n.value)}return o},u.getBase=function(t){return o(t)?[]:{}},u.clone=function(t,o){const n=new s(t,o&&o.delimeter||".");let i=u.getBase(t);for(;!n.empty();){const t=n.next();e(i,t.path.toArray(),t.value)}return i},module.exports=u;
