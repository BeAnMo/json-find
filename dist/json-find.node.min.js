"use strict";function t(t,e){let o=t,i=0;for(;void 0!==e[i]&&(o=o[e[i]],void 0!==o);)i++;return o}function e(t,e,o){let i=t,n=0;for(;void 0!==e[n+1];){const t=e[n];i=void 0===i[t]?i[t]=isNaN(e[n+1])?{}:[]:i[t],n++}return i[e[n]]=o,i}function o(t){return Array.isArray(t)}function i(t){return o(t)||function(t){return"object"==typeof t&&!o(t)&&null!==t}(t)}function n(t,e="."){return t.split(e)}function r(t,e){this.delimiter=e,o(t)?this.path=t:this.path=t.split(this.delimiter)}function s(t,e){this.doc=t,this.delim=e,this.q=[],this.setQueue(new r([],this.delim),Object.keys(this.doc))}function c(t,e={}){if(!i(t))throw new Error("Instantiating JsonFind requires an Object or an Array.");this.options={delimeter:e.delimeter||".",useConstructor:e.useConstructor||!1},this.doc=t}r.prototype.toString=function(){return this.path.join(this.delimiter)},r.prototype.toArray=function(){return this.path},r.prototype.clone=function(){return new r([...this.path],this.delimiter)},r.prototype.slice=function(t,e){return new r(this.path.slice(t,e),this.delimiter)},r.prototype.append=function(t){return this.path.push(t),this},r.prototype.setDelimeter=function(t){return this.delimiter=t,this},s.prototype.setQueue=function(t,e){return e.forEach((e=>{const o=t.clone().append(e);this.q.push(o)})),this},s.prototype.next=function(){const e=this.q.shift(),o=t(this.doc,e.toArray());return i(o)?(this.setQueue(e,Object.keys(o)),this.next()):{path:e,value:o,key:e.slice(-1).toString()}},s.prototype.empty=function(){return 0===this.q.length},c.prototype.get=function(e,o={}){if(!e)return this.doc;const r=o.useConstructor||this.options.useConstructor,s=n(e,this.options.delimeter),h=t(this.doc,s);return r&&i(h)?new c(h,this.options):h},c.prototype.set=function(t,o){const i=n(t,this.options.delimeter);return e(this.doc,i,o),this},c.prototype.fold=function(t,e){const o=new s(this.doc,this.options.delimeter);let i=e;for(;!o.empty();)i=t.call(this,i,o.next());return i},c.prototype.each=function(t){const e=new s(this.doc,this.options.delimeter);for(;!e.empty();)t.call(this,e.next())},c.prototype.transform=function(t){const e=new s(this.doc,this.options.delimeter),o=new c(c.getBase(this.doc),this.options);for(;!e.empty();){const i=e.next();o.set(i.path.toArray(),t.call(this,i))}return o},c.prototype.prune=function(t){const e=new s(this.doc,this.options.delimeter),o=new c(c.getBase(this.doc),this.options);for(;!e.empty();){const i=e.next();t.call(this,i)&&o.set(i.path.toString(),i.value)}return o},c.prototype.toggle=function(){let t=this.doc;return t=o(this.doc)?Object.keys(this.doc).reduce(((t,e)=>(t[e]=this.doc[e],t)),{}):Object.keys(this.doc).map((t=>[t,this.doc[t]]),{}),new c(t,this.options)},c.getBase=function(t){return o(t)?[]:{}},c.clone=function(t,o){const i=new s(t,o&&o.delimeter||".");let n=c.getBase(t);for(;!i.empty();){const t=i.next();e(n,t.path.toArray(),t.value)}return n},module.exports=c;
